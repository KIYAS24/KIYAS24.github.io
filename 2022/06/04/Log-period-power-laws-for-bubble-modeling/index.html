<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********  Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>Log-period power laws for bubble modeling | TzuJo&#39;s Project</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="TzuJo's Project">
    <meta name="author" content="TzuJo Hsu">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="TzuJo&#39;s Project" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="https://kiyas24.github.io/2022/06/07/Topic-Research-IV-ESG/" target="_BLANK" class="animsition-link">Topic Research- ESG</a></li>
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">Constructing</a></li>
                    
                </ul>
            </li>
            
            
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/kanga_logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">TzuJo's Project</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      

<!-- ============================ Hero Image =========================== -->



<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2022-06-04T08:16:20.000Z" itemprop="datePublished">
          2022-06-04
      </time>
    
</span>
                <h1>Log-period power laws for bubble modeling</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="About-this-Project-關於這個項目："><a href="#About-this-Project-關於這個項目：" class="headerlink" title="About this Project 關於這個項目："></a>About this Project 關於這個項目：</h2><p>這是 2021 Fall 所修陽明交大資財所開設【人工智慧理論與實務】的作業。將基因演算法(Genetic algorithm)應用在金融領域的股價泡沫，用真實數據解log-periodic power laws (LPPL) for bubble modeling的參數。</p>
<p>This is one of the homework of (2021 Fall) Artificial Intelligence: Theory and Practice. We apply Genetic Algorithm to approximate the optimal solution by minimizing the average fitness error between time 0 and t_c, in hope to detect the stock bubble in the field of finance. </p>
<p><img src="/img/AI_intro/LPPL.png" alt="result1"></p>
<hr>
<p>The idea is to solve the parameters in two steps, first by obtaining the genes, which includes 4 non-linear variables tc, β, ω, Φ, with them plugged in to the function, we further use linear regression to estimate the optimal A, B, C. The fitness error is measured by Mean Absolute Error.</p>
<div align="center">
    <img src="/img/AI_intro/lppl_output.png" width="500"> 
</div>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Define Functions</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">data = np.load(<span class="string">&#x27;/AI/data.npy&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fitness</span>(<span class="params">A,B,C,w,Beta,Phi,t_c,t</span>):</span><br><span class="line">    <span class="keyword">return</span> (A + B*((t_c - t)**Beta)*(<span class="number">1</span>+ C* np.cos(w*np.log(t_c - t)) + Phi))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MAE</span>(<span class="params">real, predict</span>):</span><br><span class="line">    <span class="keyword">return</span>(np.mean(<span class="built_in">abs</span>(real[:<span class="built_in">len</span>(predict)]  - predict)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gene2coef</span>(<span class="params">gene</span>):</span><br><span class="line">    w = ((np.<span class="built_in">sum</span>(<span class="number">2</span>**np.arange(<span class="number">10</span>)*gene[<span class="number">0</span>:<span class="number">10</span>]))*<span class="number">3.15</span>/<span class="number">1023</span>)+<span class="number">4</span> <span class="comment">#放大範圍</span></span><br><span class="line">    Beta = ((np.<span class="built_in">sum</span>(<span class="number">2</span>**np.arange(<span class="number">10</span>)*gene[<span class="number">10</span>:<span class="number">20</span>]))*<span class="number">0.4</span>)/<span class="number">1023</span> + <span class="number">0.25</span> <span class="comment">#0.33 / 0.18</span></span><br><span class="line">    Phi = (np.<span class="built_in">sum</span>(<span class="number">2</span>**np.arange(<span class="number">10</span>)*gene[<span class="number">20</span>:<span class="number">30</span>]))*<span class="number">2</span>*np.pi/<span class="number">1023</span></span><br><span class="line">    t_c = np.rint(((np.<span class="built_in">sum</span>(<span class="number">2</span>**np.arange(<span class="number">10</span>)*gene[<span class="number">30</span>:<span class="number">40</span>]))*<span class="number">15</span>/<span class="number">1023</span>)+<span class="number">500</span>)</span><br><span class="line">    <span class="keyword">return</span> w, Beta, Phi, t_c</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gene</span>(<span class="params">N,G,survive_rate,mutation_rate</span>):</span><br><span class="line">    mutation = <span class="built_in">round</span>(N*<span class="number">40</span>*mutation_rate)</span><br><span class="line">    survive = <span class="built_in">round</span>(N*survive_rate)</span><br><span class="line">    pop = np.random.randint(<span class="number">0</span>,<span class="number">2</span>,(N,<span class="number">40</span>)) <span class="comment">#第一群生物</span></span><br><span class="line">    fit =  np.zeros((N,<span class="number">1</span>)) <span class="comment">#每一個人有多適合活在這個世界上</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> generation <span class="keyword">in</span> <span class="built_in">range</span>(G):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">            w, Beta, Phi, t_c = gene2coef(pop[i,:])</span><br><span class="line">            t_c = <span class="built_in">int</span>(t_c)</span><br><span class="line">            M = np.zeros((t_c,<span class="number">3</span>))</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(t_c):</span><br><span class="line">                M[t,<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">                M[t,<span class="number">1</span>] = (t_c-t)**Beta</span><br><span class="line">                M[t,<span class="number">2</span>] = ((t_c-t)**Beta)*np.cos(w*np.log(t_c-t)+Phi)</span><br><span class="line">            ABD = np.linalg.lstsq(M,ln_data[:t_c],rcond=<span class="literal">None</span>)[<span class="number">0</span>]</span><br><span class="line">            A,B,C = ABD[<span class="number">0</span>], ABD[<span class="number">1</span>], ABD[<span class="number">2</span>]/ABD[<span class="number">1</span>]</span><br><span class="line">            predict = np.zeros(t_c)</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(t_c):</span><br><span class="line">                predict[t] = np.exp(fitness(A,B,C,w,Beta,Phi,t_c,t))</span><br><span class="line">            fit[i] = MAE(data,predict)</span><br><span class="line">        </span><br><span class="line">        sortf = np.argsort(fit[:,<span class="number">0</span>]) <span class="comment">#回傳最小的index</span></span><br><span class="line">        pop = pop[sortf,:] <span class="comment">#依照排序放好，重新assign回去</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(survive,N): <span class="comment">#killing </span></span><br><span class="line">            fid = np.random.randint(<span class="number">0</span>,survive) <span class="comment">#0~99其中一個數字in this case #遮罩交配</span></span><br><span class="line">            mid = np.random.randint(<span class="number">0</span>,survive)</span><br><span class="line">            <span class="keyword">while</span>(fid==mid):</span><br><span class="line">                mid = np.random.randint(<span class="number">0</span>,survive)</span><br><span class="line">            mask = np.random.randint(<span class="number">0</span>,<span class="number">2</span>,(<span class="number">1</span>,<span class="number">40</span>))</span><br><span class="line">            son = pop[mid,:].copy()</span><br><span class="line">            father = pop[fid,:]</span><br><span class="line">            son[mask[<span class="number">0</span>,:]==<span class="number">1</span>] = father[mask[<span class="number">0</span>,:]==<span class="number">1</span>]</span><br><span class="line">            pop[i,:] = son</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(mutation):</span><br><span class="line">            m = np.random.randint(<span class="number">0</span>,N)</span><br><span class="line">            n = np.random.randint(<span class="number">0</span>,<span class="number">40</span>)</span><br><span class="line">            pop[m,n] = <span class="number">1</span>-pop[m,n]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">            w, Beta, Phi, t_c = gene2coef(pop[i,:])</span><br><span class="line">            t_c = <span class="built_in">int</span>(t_c)</span><br><span class="line">            M = np.zeros((t_c,<span class="number">3</span>))</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(t_c):</span><br><span class="line">                M[t,<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">                M[t,<span class="number">1</span>] = (t_c-t)**Beta</span><br><span class="line">                M[t,<span class="number">2</span>] = ((t_c-t)**Beta)*np.cos(w*np.log(t_c-t)+Phi)</span><br><span class="line">            ABD = np.linalg.lstsq(M,ln_data[:t_c],rcond=<span class="literal">None</span>)[<span class="number">0</span>]</span><br><span class="line">            A,B,C = ABD[<span class="number">0</span>], ABD[<span class="number">1</span>], ABD[<span class="number">2</span>]/ABD[<span class="number">1</span>]</span><br><span class="line">            predict = np.zeros(t_c)</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(t_c):</span><br><span class="line">                predict[t] = np.exp(fitness(A,B,C,w,Beta,Phi,t_c,t))</span><br><span class="line">            fit[i] = MAE(data,predict)</span><br><span class="line">    sortf = np.argsort(fit[:,<span class="number">0</span>]) <span class="comment">#回傳最小的index</span></span><br><span class="line">    pop = pop[sortf,:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    w, Beta, Phi, t_c = gene2coef(pop[<span class="number">0</span>,:])</span><br><span class="line">    t_c = <span class="built_in">int</span>(t_c)</span><br><span class="line">    M = np.zeros((t_c,<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(t_c):</span><br><span class="line">        M[t,<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        M[t,<span class="number">1</span>] = (t_c-t)**Beta</span><br><span class="line">        M[t,<span class="number">2</span>] = ((t_c-t)**Beta)*np.cos(w*np.log(t_c-t)+Phi)</span><br><span class="line">    ABD = np.linalg.lstsq(M,ln_data[:t_c],rcond=<span class="literal">None</span>)[<span class="number">0</span>]</span><br><span class="line">    A,B,C = ABD[<span class="number">0</span>], ABD[<span class="number">1</span>], ABD[<span class="number">2</span>]/ABD[<span class="number">1</span>]</span><br><span class="line">    predict = np.zeros(t_c)</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(t_c):</span><br><span class="line">        predict[t] = np.exp(fitness(A,B,C,w,Beta,Phi,t_c,t))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> A,B,C,w,Beta,Phi,t_c</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 主程式</span></span><br><span class="line">ln_data = np.log(data)</span><br><span class="line">N,G,survive_rate,mutation_rate = <span class="number">10000</span>,<span class="number">30</span>,<span class="number">0.05</span>,<span class="number">0.001</span></span><br><span class="line">A,B,C,w,Beta,Phi,t_c = gene(N,G,survive_rate,mutation_rate)</span><br><span class="line">predict = np.zeros(<span class="built_in">int</span>(t_c))</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(t_c):</span><br><span class="line">    predict[t] = np.exp(fitness(A,B,C,w,Beta,Phi,t_c,t))</span><br><span class="line"><span class="built_in">print</span>(np.mean(<span class="built_in">abs</span>(data[:<span class="built_in">len</span>(predict)]  - predict)))</span><br><span class="line">x = np.arange(<span class="number">0</span>,t_c)</span><br><span class="line">x2 = np.arange(<span class="number">0</span>,<span class="number">600</span>)</span><br><span class="line">plt.plot(x, predict, label = <span class="string">&quot;predict&quot;</span>)</span><br><span class="line">plt.plot(x2, data[:], label = <span class="string">&quot;data&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    <a class="pull-left" href="/2022/06/05/CV-object-detection/" style="float: left;">
        ← Object detection 物件偵測（CV）
    </a>
    
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By TzuJo Hsu. All Rights Reserved.
                </p>
                <p>Theme By <a target="_blank" rel="noopener" href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
